<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Location Unlock Grid</title>
  <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/crypto-js.min.js"></script>
  <style>
    .shimmer {
      background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(218,165,32,0.5) 50%, rgba(255,255,255,0) 100%);
      background-size: 200% 100%;
      animation: 2000ms linear -19.456ms infinite normal none running shimmer;
    }
    @keyframes shimmer {
      0% { background-position: -100% 0; }
      100% { background-position: 100% 0; }
    }

  </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div id="grid" class="hidden place-items-center grid grid-cols-2 gap-4 p-4 w-full max-w-md">
    <!-- Items will be rendered here -->
  </div>

  <!-- Modal for locked item -->
  <div id="modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center">
    <div class="bg-white p-6 rounded-lg shadow-lg text-center">
      <h2 id="modal-title" class="text-xl font-bold mb-2"></h2>
      <p id="modal-message" class="text-gray-600"></p>
      <button onclick="closeModal()" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded">Close</button>
    </div>
  </div>

  <video id="video" class="fixed inset-0 w-full h-full object-cover hidden z-50" controls></video>

  <!-- Password Prompt -->
  <div id="passwordPrompt" class="bg-white p-6 rounded shadow-md w-96">
    <h2 class="text-lg font-semibold mb-4">Enter Password</h2>
    <input type="password" id="passwordInput" class="w-full border border-gray-300 rounded px-3 py-2 mb-4" placeholder="Password">
    <button id="submitPassword" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 w-full">Unlock</button>
    <p id="errorMsg" class="text-red-500 text-sm mt-2 hidden">Incorrect password or decryption failed.</p>
  </div>

  <script>
    const encryptedKey = 'encryptedJS';
    const passwordKey = 'jsPassword';
    const ITEMS = []
    const done = "no"

    
    const encryptedcode = 'U2FsdGVkX181s7oCpadwFzANO1YxmWksdI9HR2vqSIO+G5RZUgUL/xpUDAncXdzw4Sgtf90OOpyhP3jzqklq1CsgY8r/RC5SoN/zETsiAWQPe1m+F4pJvIQeui1vKl94ibjiGKY3m4R1ItRD45/k2gYu6SBIMBt+MlOvsH0ylVP0BnwStuySIsYpSTCSYH8ECsySpLJiPTWL222enTiycteDRz+Q5WB75H565zjy8biLgo5yzMu/ttNImeKUWvOvne7aTrQH0G9TZvtEcW/ZhR9RdyX6nRhk5xAl+svk9uhub1A2x4oOT0niS8s7b4orJgCxtG+hzr1oLUsc+VrPzno8qNDHnU6+QAWbTI1+/wCniRr5JJ3TEYoAHr2kZ7r63rcHIxIjymxmtn5Tm7YeENIubP3Fw2BIUhv8oFpX8Taf/8hPMxkFyyJPk8BBniRORbZke7Dnc66ZcSaj+qsSVmED8zFaqSk2pooT4Tf3NjkfRwTB3CnCJ84oR44CQ74jomruWdZVFzZVX/I++u+9FylW+OtyKDSlOphXrBx5MpPwzhglQ/WXoYUVkderr9cKBZ0btaCVHflZRJE6DAmJjh/4bxGPZk094hj+dGa722arQ05yS5HixJtEAk9RvXGOYiYELNumJFvjQuZfwFR4a4WquMng7lcbFW1Tz+HRyNK49jf6HIu+xeJletr/g4/ckibdpmcKVmmmy/tKByTPkE2OURohe2iDW5UkjooQDNKwCd3u39sFc8BhVT7N/utIGDA8bidbu7JIiSuzdEFxFfkKAJ8/Yyk1CwslkS769Wm/Q0ef97RWBXU7yy9ezi1ledM2esvAWruROfHCV85qQkvyS9nEzEU4zfT2dBCYa1i/B+nohW3drFE2zMXniUNjD5Jlpd3ZKR6ztlRREHfKmMqVi/oqP/cYKYZMztjFtJoP2Oe/nt16dKbvgfbmYKsQimBJcXLwkX/+K32hDFW3E+b305wmgiZ2I2KkLLjm8wRo704UGQUMrBi+gjmPpfKwyY/c6we2+gpuAMLnJMGY7Rl9ontoK4/jIPsCoHjcNar6L3/3prqh1TPUXIg6op0+K2kLu9a7PLsyvywPEfDQKWmtvCcc4sZwPCDx2OWDM9YEPIxRfNZxw2y3r1yiCxUJ9wxPGMoYHd/Tl9AdBduZRuA+dDZBXSvEdvb1VuHRVFDbSsgvSr2DrZRFDDD+VtpUws4B0mF0ucA6Mbaf1X5blyp5H5vlv7WJWbuHVBig9IH6i/Ildh1G3V7MBxRMoleXTAsRTjBNtOm+vmk3bKZ8Nv3joOxvK+ihCxpMGutLcJ6Gc9EXXBW88KieM/Djj6C/eIhpKRueMZuOw8+vl3H7VFFvqhA8UDaTY8Kd5OQAgYqKoc9yWBnHqQkEssUQUGK9KEFw9Gic4treZyy6nRw07n//DDj2Hii7zKlhdypTqNXFdiX/qjoF9yYatLwMVTa43/WZrbx1KZqt7E9QIu6ISSqUfpbtBfNWy6emslaYJyIKwBBeuMyzMPb0Z/7VyvJFU3aTFysMBEhhZ9bh5+REoaZZCkdMdUn4mD0reHfGIto6TbqS3dLlxasSrYFGg+7EovpOLP2oELgTyZp1AIxUL7y5CXHjA5Xwp3sFcbgegcY0/lmzwBLrdlMcDCIKhI+6++/fat88hw2DZRHAM4IvQ91rgxiyrc6uith8LllAds//n+PlhiME0mLaI3hcPU1OAY/CjwY27/2OS42Sx7mEWjUNuryP8KFXk8ob9ywqqGrqb0/Cy+swe314m6AMO3djcdwizG+heUH6a1KwPDGh2tndutvN4e1lxQt/rFNXG59WU63ASImgtpSksb1A4VSTjNzqG5V5UdxmF4ZOi9QiXNZIgU6TXoXCB0jP+P9v9gk/+sLY9gyRE+O/XKLUHv1yIn02ysLpWslV1ZF79kFE+dJei2RjNrsX21RTygSGSgI=';

    function decryptJSCode(encryptedCode, password) {
      const decrypted = CryptoJS.AES.decrypt(encryptedCode, password);
      const plain = decrypted.toString(CryptoJS.enc.Utf8);
      return plain || null;
    }

    function runDecryptedCode(code, localstorageexists) {
      console.log(code);
      const ITEMS = code
      executeondecryption(code)
      const done = "yes"

    }

    function handleDecryption(password, localstorageexists) {

      const decryptedCode = decryptJSCode(encryptedcode, password);
      if (!decryptedCode) return false;

      if (!localstorageexists) localStorage.setItem(passwordKey, password);
      
      runDecryptedCode(decryptedCode, localstorageexists);
      return true;
    }

    
    // Optional: Demo only - store encrypted JS if not already present
    (function storeSampleEncryptedCodeOnce() {
      const hello = 1;
    })();



    function executeondecryption(ITEMS) {



      ITEMS = JSON.parse(ITEMS);



    const localKey = 'unlockedItems';
    let unlocked = JSON.parse(localStorage.getItem(localKey) || '[]');
    let eligible = [];

    const grid = document.getElementById('grid');

    function renderGrid() {
      grid.innerHTML = '';
     
      ITEMS.forEach(item => {
        const isUnlocked = unlocked.includes(item.id);
        const isEligible = eligible.includes(item.id);
        const div = document.createElement('div');
        div.className = `flex items-center justify-center w-240 h-240 rounded-xl cursor-pointer shadow bg-white ${isUnlocked ? '' : 'grayscale'}`;

        const img = document.createElement('img');
        img.src = item.icon;
        img.className = `h-220 w-220 object-contain ${isUnlocked ? '' : 'opacity-60'}`;
        div.appendChild(img);

        if (isUnlocked) {
          div.onclick = () => window.location.href = item.url;
        } else if (isEligible) {
          div.classList.add('shimmer');
          div.classList.remove('grayscale');
          div.onclick = () => playVideo(item);
        } else {
          div.onclick = () => showModal(item);
        }

        div.dataset.id = item.id;
     

        grid.appendChild(div);
        document.getElementById("grid").classList.remove("hidden");
      });
    }
    

    function showModal(item) {
      document.getElementById('modal-title').innerText = item.title;
      document.getElementById('modal-message').innerText = item.message;
      document.getElementById('modal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('modal').style.display = 'none';
    }

    function checkProximity(pos) {
      const { latitude, longitude } = pos.coords;
      ITEMS.forEach(item => {
        if (!unlocked.includes(item.id)) {
          const dist = getDistanceFromLatLonInM(latitude, longitude, item.lat, item.lng);
          if (dist < item.radius && !eligible.includes(item.id)) {
            eligible.push(item.id);

          }
        }
      });
      renderGrid();
    }

    function getDistanceFromLatLonInM(lat1, lon1, lat2, lon2) {
      const R = 6371e3;
      const φ1 = lat1 * Math.PI/180;
      const φ2 = lat2 * Math.PI/180;
      const Δφ = (lat2 - lat1) * Math.PI/180;
      const Δλ = (lon2 - lon1) * Math.PI/180;
      const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
                Math.cos(φ1) * Math.cos(φ2) *
                Math.sin(Δλ/2) * Math.sin(Δλ/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      //return R * c;
      return 0;
    }

    function playVideo(item) {
      unlocked.push(item.id);
      localStorage.setItem(localKey, JSON.stringify(unlocked));
      const video = document.getElementById('video');
      video.src = item.video;
      video.style.display = 'block';
      video.play();
      video.onended = () => {
        window.location.href = item.url;
        //video.style.display = 'none';


      //  
      //  localStorage.setItem(localKey, JSON.stringify(unlocked));
      //  renderGrid();
      };
    }

    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(checkProximity);
    } else {
      alert('Geolocation is not supported.');
    }

    renderGrid();
    }


function closeModal() {
      document.getElementById('modal').style.display = 'none';
    }

    
    document.addEventListener("DOMContentLoaded", () => {
      const storedPassword = localStorage.getItem(passwordKey);

      if (storedPassword && handleDecryption(storedPassword, true)) {
        document.getElementById("passwordPrompt").classList.add("hidden");
        return;
      }

      document.getElementById("submitPassword").addEventListener("click", () => {
        const inputPassword = document.getElementById("passwordInput").value;
        const success = handleDecryption(inputPassword, false);

        if (success) {
          document.getElementById("passwordPrompt").classList.add("hidden");
          document.getElementById("errorMsg").classList.remove("hidden");
        } else {
          document.getElementById("errorMsg").classList.remove("hidden");
        }
      });
    });

  </script>
</body>
</html>
